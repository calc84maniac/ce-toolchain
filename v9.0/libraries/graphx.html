<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>graphx.h &mdash; CE C/C++ Toolchain  documentation</title><link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="keypadc.h" href="keypadc.html" />
    <link rel="prev" title="fontlibc.h" href="fontlibc.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> CE C/C++ Toolchain
          </a>
              <div class="version">
                v9.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption"><span class="caption-text">Overview</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../index.html">Welcome to the CE C Toolchain!</a></li>
<li class="toctree-l1"><a class="reference internal" href="../static/getting-started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../static/faq.html">Frequently Asked Questions</a></li>
</ul>
<p class="caption"><span class="caption-text">Toolchain Documentation</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../static/printf.html">Using printf Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../static/fileio.html">Using File I/O Functions</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">CE C Libraries</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="fileioc.html">fileioc.h</a></li>
<li class="toctree-l2"><a class="reference internal" href="fontlibc.html">fontlibc.h</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">graphx.h</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#default-palette">Default Palette</a></li>
<li class="toctree-l3"><a class="reference internal" href="#clipped-vs-unclipped">Clipped vs. Unclipped</a></li>
<li class="toctree-l3"><a class="reference internal" href="#partial-redraw">Partial Redraw</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#the-implementation">The Implementation</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#buffering-graphics">Buffering Graphics</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#method-1-copying-blitting">Method 1 (Copying/Blitting)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#method-2-buffer-swapping">Method 2 (Buffer Swapping)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#pros-and-cons">Pros and Cons</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#creating-sprites">Creating Sprites</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#getting-started">Getting Started</a></li>
<li class="toctree-l4"><a class="reference internal" href="#converting-sprites">Converting Sprites</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#api-documentation">API Documentation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="keypadc.html">keypadc.h</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../headers/index.html">CE C Toolchain Specific Headers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../static/debugging.html">Debugging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../static/makefile-options.html">Makefile Options</a></li>
</ul>
<p class="caption"><span class="caption-text">Contributing</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../static/contributing.html">Contributing to the CE C Toolchain</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">CE C/C++ Toolchain</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="index.html">CE C Libraries</a> &raquo;</li>
      <li>graphx.h</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="graphx-h">
<span id="id1"></span><h1>graphx.h<a class="headerlink" href="#graphx-h" title="Permalink to this headline"></a></h1>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;graphx.h&gt;</span><span class="cp"></span>
</pre></div>
</div>
<p>The graphx library implements efficient graphics routines from everything to drawing sprites, shapes, and tilemaps.
This allows a programmer to easily add quality graphics to their program without needing to worry about the low-level implementation details.</p>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#default-palette" id="id2">Default Palette</a></p></li>
<li><p><a class="reference internal" href="#clipped-vs-unclipped" id="id3">Clipped vs. Unclipped</a></p></li>
<li><p><a class="reference internal" href="#partial-redraw" id="id4">Partial Redraw</a></p>
<ul>
<li><p><a class="reference internal" href="#the-implementation" id="id5">The Implementation</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#buffering-graphics" id="id6">Buffering Graphics</a></p>
<ul>
<li><p><a class="reference internal" href="#method-1-copying-blitting" id="id7">Method 1 (Copying/Blitting)</a></p></li>
<li><p><a class="reference internal" href="#method-2-buffer-swapping" id="id8">Method 2 (Buffer Swapping)</a></p></li>
<li><p><a class="reference internal" href="#pros-and-cons" id="id9">Pros and Cons</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#creating-sprites" id="id10">Creating Sprites</a></p>
<ul>
<li><p><a class="reference internal" href="#getting-started" id="id11">Getting Started</a></p></li>
<li><p><a class="reference internal" href="#converting-sprites" id="id12">Converting Sprites</a></p>
<ul>
<li><p><a class="reference internal" href="#explanation-of-output" id="id13">Explanation of output</a></p></li>
</ul>
</li>
</ul>
</li>
<li><p><a class="reference internal" href="#api-documentation" id="id14">API Documentation</a></p></li>
</ul>
</div>
<div class="section" id="default-palette">
<h2><a class="toc-backref" href="#id2">Default Palette</a><a class="headerlink" href="#default-palette" title="Permalink to this headline"></a></h2>
<p>This is the default palette used by graphx.
This palette can be modified at any time with different colors.</p>
<img alt="../_images/graphx_palette.png" class="align-center" src="../_images/graphx_palette.png" />
</div>
<div class="section" id="clipped-vs-unclipped">
<h2><a class="toc-backref" href="#id3">Clipped vs. Unclipped</a><a class="headerlink" href="#clipped-vs-unclipped" title="Permalink to this headline"></a></h2>
<p>The graphx library contains many similar functions, e.g. <code class="code docutils literal notranslate"><span class="pre">gfx_Sprite</span></code> and <code class="code docutils literal notranslate"><span class="pre">gfx_Sprite_NoClip</span></code>.</p>
<p>As the name suggests, the <strong>_NoClip</strong> variant of a routine performs no clipping.
Clipping is the process of checking if parts (or all) of an object to be drawn are outside the window bounds and skipping drawing these out of bounds parts.
This checking process takes time.
If you can be sure that an object to be drawn is fully within the bounds of the screen, the clipping process can be safely skipped by using the <strong>_NoClip</strong> variant of the routine.</p>
<p><strong>Do not use the _NoClip variant of a routine if you can not be sure that the object to be drawn is fully within the bounds of the screen. Doing so may result in corrupted graphics or memory.</strong></p>
</div>
<div class="section" id="partial-redraw">
<h2><a class="toc-backref" href="#id4">Partial Redraw</a><a class="headerlink" href="#partial-redraw" title="Permalink to this headline"></a></h2>
<p>Partial redraw applies when you are moving a transparent sprite against a static background.
This can be problematic, as you may not want to redraw the whole background each time.
Partial redraw saves a copy of what is behind the transparent sprite, and draws it when the sprite moves again.</p>
<div class="section" id="the-implementation">
<h3><a class="toc-backref" href="#id5">The Implementation</a><a class="headerlink" href="#the-implementation" title="Permalink to this headline"></a></h3>
<p>A brief summation of the paritial redraw using graphx is:</p>
<ul class="simple">
<li><p>Allocate space for a temporary sprite.</p></li>
<li><p>When the background is drawn, a small copy of it is saved to the temporary spirte.</p></li>
<li><p>After the background is drawn, the sprite is drawn as normal.</p></li>
<li><p>Upon movement, the sprite is erased using the temporary sprite and the coordinates are updated.</p></li>
<li><p>The section of background with the updated coordinates is stored to the temporary sprite and the process repeated.</p></li>
</ul>
<p>This is implemented using somewhat pseudo code:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="n">gfx_sprite_t</span> <span class="o">*</span><span class="n">behind_sprite</span> <span class="o">=</span> <span class="n">gfx_MallocSprite</span><span class="p">(</span><span class="n">SPRITE_WIDTH</span><span class="p">,</span> <span class="n">SPRITE_HEIGHT</span><span class="p">);</span>

<span class="c1">// ...draw the background code  here...</span>

<span class="c1">// set initial sprite state</span>
<span class="n">gfx_GetSprite</span><span class="p">(</span><span class="n">behind_sprite</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">);</span>
<span class="n">gfx_TransparentSprite</span><span class="p">(</span><span class="n">sprite</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">);</span>

<span class="k">do</span> <span class="p">{</span>
    <span class="c1">// if we don&#39;t need to move, loop</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">no_move</span><span class="p">)</span> <span class="k">continue</span><span class="p">;</span>

    <span class="c1">// clear out the old sprite</span>
    <span class="n">gfx_Sprite</span><span class="p">(</span><span class="n">behind_sprite</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">);</span>

    <span class="c1">// ...movement code here...</span>
    <span class="c1">// updates x and y</span>

    <span class="c1">// get the new background and draw the moved sprite</span>
    <span class="n">gfx_GetSprite</span><span class="p">(</span><span class="n">behind_sprite</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">);</span>
    <span class="n">gfx_TransparentSprite</span><span class="p">(</span><span class="n">sprite</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">);</span>
<span class="p">}</span> <span class="k">while</span> <span class="p">(</span><span class="n">moving</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="buffering-graphics">
<h2><a class="toc-backref" href="#id6">Buffering Graphics</a><a class="headerlink" href="#buffering-graphics" title="Permalink to this headline"></a></h2>
<p>Buffering is a fancy method in order to prevent graphics from being displayed as they are being drawn.
It is used primarily to eliminate visible draws which can make an application look amateurish, sluggish, or appear to flicker.</p>
<p>When graphics routines are buffered, they draw offscreen (nonvisible) portion of memory, so the user doesn’t see the partial drawing.
This is accomplished in one line with the following routine, usually placed directly after calling <cite>gfx_Begin()</cite>:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">gfx_SetDrawBuffer</span><span class="p">();</span>
</pre></div>
</div>
<p>The next part is deciding how the drawn graphics should be displayed to the user.</p>
<div class="section" id="method-1-copying-blitting">
<h3><a class="toc-backref" href="#id7">Method 1 (Copying/Blitting)</a><a class="headerlink" href="#method-1-copying-blitting" title="Permalink to this headline"></a></h3>
<p>The first method is to copy (commonly referred to as ‘blitting’) whatever is in the buffer to the visible screen.
The simplest way is to call:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">gfx_BlitBuffer</span><span class="p">();</span>
</pre></div>
</div>
<p>Which will copy/blit the entire buffer to the screen.
Alternatively, <cite>gfx_BlitLines()</cite> and <cite>gfx_BlitRectangle()</cite> and the other variations are used to specify the blitting bounds.</p>
</div>
<div class="section" id="method-2-buffer-swapping">
<h3><a class="toc-backref" href="#id8">Method 2 (Buffer Swapping)</a><a class="headerlink" href="#method-2-buffer-swapping" title="Permalink to this headline"></a></h3>
<p>Buffer swapping swaps the visible screen with an offscreen buffer, leaving the contents on both.
Whatever is currently on the screen will become the graphics buffer, and whatever is in the graphics buffer will be displayed on the screen
The code to swap the visible screen with nonvisibile buffer is:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">gfx_SwapDraw</span><span class="p">();</span>
</pre></div>
</div>
<p>What actually happens is shown below, ‘graphics’ is simply where the graphics routines will draw to.</p>
<img alt="../_images/graphx_buffer.png" class="align-center" src="../_images/graphx_buffer.png" />
<p>This method is really useful when you are redrawing all of the graphics each frame, and requires more work to handle if you only wish to do a partial redraw.</p>
</div>
<div class="section" id="pros-and-cons">
<h3><a class="toc-backref" href="#id9">Pros and Cons</a><a class="headerlink" href="#pros-and-cons" title="Permalink to this headline"></a></h3>
<p>Buffering is slower than drawing to the main screen, but greatly improves perceived performance which is extremely important in graphical applications.</p>
<p><strong>Blitting</strong>: Easy, simply a copy to the screen.</p>
<p><strong>Swapping</strong>: Requires more programmer management (sometimes), faster than blitting.</p>
</div>
</div>
<div class="section" id="creating-sprites">
<h2><a class="toc-backref" href="#id10">Creating Sprites</a><a class="headerlink" href="#creating-sprites" title="Permalink to this headline"></a></h2>
<p>Sprites are images that contain pixel data that can be drawn via graphx functions.
The CE C Toolchain includes <a class="reference external" href="https://github.com/mateoconlechuga/convimg">convimg</a>, which is used to convert images in PNG or similar formats into binary data that can be used by graphx.</p>
<div class="section" id="getting-started">
<h3><a class="toc-backref" href="#id11">Getting Started</a><a class="headerlink" href="#getting-started" title="Permalink to this headline"></a></h3>
<p>We are going to begin by taking a look at an example program to familiarize ourselves with how to run and configure convimg.</p>
<p>Open the <cite>graphx/sprites</cite> example, and navigate to the <cite>src/gfx</cite> folder.</p>
<p>The image <code class="code docutils literal notranslate"><span class="pre">oiram.png</span></code> is the sprite that wants to be converted, and <code class="code docutils literal notranslate"><span class="pre">convimg.yaml</span></code> is used to configure how the image should be converted.</p>
<p>Open <code class="code docutils literal notranslate"><span class="pre">convimg.yaml</span></code> in a text editor, which contains the below lines.
Run the command <code class="code docutils literal notranslate"><span class="pre">convimg</span> <span class="pre">--help</span></code>. This outputs the readme for convimg, and what each of the various commands do.
You can also find the readme online, available <a class="reference external" href="https://github.com/mateoconlechuga/convimg/blob/master/README.md">here</a>.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">palettes</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">global_palette</span>
    <span class="nt">fixed-entries</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="nt">color</span><span class="p">:</span> <span class="p p-Indicator">{</span><span class="nt">index</span><span class="p">:</span> <span class="nv">0</span><span class="p p-Indicator">,</span><span class="nt"> r</span><span class="p">:</span> <span class="nv">255</span><span class="p p-Indicator">,</span><span class="nt"> g</span><span class="p">:</span> <span class="nv">0</span><span class="p p-Indicator">,</span><span class="nt"> b</span><span class="p">:</span> <span class="nv">128</span><span class="p p-Indicator">}</span>
      <span class="p p-Indicator">-</span> <span class="nt">color</span><span class="p">:</span> <span class="p p-Indicator">{</span><span class="nt">index</span><span class="p">:</span> <span class="nv">1</span><span class="p p-Indicator">,</span><span class="nt"> r</span><span class="p">:</span> <span class="nv">255</span><span class="p p-Indicator">,</span><span class="nt"> g</span><span class="p">:</span> <span class="nv">255</span><span class="p p-Indicator">,</span><span class="nt"> b</span><span class="p">:</span> <span class="nv">255</span><span class="p p-Indicator">}</span>
    <span class="nt">images</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">automatic</span>

<span class="nt">converts</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">sprites</span>
    <span class="nt">palette</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">global_palette</span>
    <span class="nt">transparent-color-index</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">0</span>
    <span class="nt">images</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">oiram.png</span>

<span class="nt">outputs</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">c</span>
    <span class="nt">include-file</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">gfx.h</span>
    <span class="nt">palettes</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">global_palette</span>
    <span class="nt">converts</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">sprites</span>
</pre></div>
</div>
</div>
<div class="section" id="converting-sprites">
<h3><a class="toc-backref" href="#id12">Converting Sprites</a><a class="headerlink" href="#converting-sprites" title="Permalink to this headline"></a></h3>
<p>Converting sprites requires you to type <code class="code docutils literal notranslate"><span class="pre">make</span> <span class="pre">gfx</span></code> instead of <code class="code docutils literal notranslate"><span class="pre">make</span></code>.
Any time you change an image or the <code class="code docutils literal notranslate"><span class="pre">convimg.yaml</span></code>, you will need to execute this command.</p>
<img alt="../_images/graphx_sprites.png" class="align-center" src="../_images/graphx_sprites.png" />
<p>You can now <code class="code docutils literal notranslate"><span class="pre">make</span></code> the project as you would any of the other examples.</p>
<div class="section" id="explanation-of-output">
<h4><a class="toc-backref" href="#id13">Explanation of output</a><a class="headerlink" href="#explanation-of-output" title="Permalink to this headline"></a></h4>
<p>Sprites used in the graphx library are allowed 8 bits per pixel <em>(aka 8bpp)</em>, which allows for a total of <code class="code docutils literal notranslate"><span class="pre">256</span></code> colors.
As shown in the previous image, convimg was able to create a suitable palette for <code class="code docutils literal notranslate"><span class="pre">oiram.png</span></code> with 15 colors.
Once the palette is generated, convimg outputs C headers and source files that are automatically picked up by the toolchain and compiled into the final program.</p>
</div>
</div>
</div>
<div class="section" id="api-documentation">
<h2><a class="toc-backref" href="#id14">API Documentation</a><a class="headerlink" href="#api-documentation" title="Permalink to this headline"></a></h2>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>doxygenfile: Unable to find project ‘CE C Toolchain’ in breathe_projects dictionary</p>
</div>
</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="fontlibc.html" class="btn btn-neutral float-left" title="fontlibc.h" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="keypadc.html" class="btn btn-neutral float-right" title="keypadc.h" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2015-2022 CE Programming.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  
  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"> Toolchain Version</span>
      v9.0
      <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
      
      <dl>
        <dt>Versions</dt>
        
          
          <dd><a href="/toolchain/master/index.html">master</a></dd>
          
        
           <strong> 
          <dd><a href="/toolchain/v9.0/index.html">v9.0</a></dd>
           </strong> 
        
          
          <dd><a href="/toolchain/v9.1/index.html">v9.1</a></dd>
          
        
          
          <dd><a href="/toolchain/v9.2/index.html">v9.2</a></dd>
          
        
      </dl>
      
    </div>
  </div>
<script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>